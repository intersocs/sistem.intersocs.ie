{"code":"/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nimport * as tslib_1 from \"tslib\";\r\nimport { deleteInstallation as deleteInstallationRequest } from '../api/delete-installation';\r\nimport { extractAppConfig } from '../helpers/extract-app-config';\r\nimport { remove, update } from '../helpers/idb-manager';\r\nimport { ERROR_FACTORY } from '../util/errors';\r\nexport function deleteInstallation(app) {\r\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n        var appConfig, entry;\r\n        return tslib_1.__generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    appConfig = extractAppConfig(app);\r\n                    return [4 /*yield*/, update(appConfig, function (oldEntry) {\r\n                            if (oldEntry &&\r\n                                oldEntry.registrationStatus === 0 /* NOT_STARTED */) {\r\n                                // Delete the unregistered entry without sending a deleteInstallation request.\r\n                                return undefined;\r\n                            }\r\n                            return oldEntry;\r\n                        })];\r\n                case 1:\r\n                    entry = _a.sent();\r\n                    if (!entry) return [3 /*break*/, 6];\r\n                    if (!(entry.registrationStatus === 1 /* IN_PROGRESS */)) return [3 /*break*/, 2];\r\n                    // Can't delete while trying to register.\r\n                    throw ERROR_FACTORY.create(\"delete-pending-registration\" /* DELETE_PENDING_REGISTRATION */);\r\n                case 2:\r\n                    if (!(entry.registrationStatus === 2 /* COMPLETED */)) return [3 /*break*/, 6];\r\n                    if (!!navigator.onLine) return [3 /*break*/, 3];\r\n                    throw ERROR_FACTORY.create(\"app-offline\" /* APP_OFFLINE */);\r\n                case 3: return [4 /*yield*/, deleteInstallationRequest(appConfig, entry)];\r\n                case 4:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, remove(appConfig)];\r\n                case 5:\r\n                    _a.sent();\r\n                    _a.label = 6;\r\n                case 6: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n//# sourceMappingURL=delete-installation.js.map","references":["/tmp/firebase-TMP/firebase-js-sdk/packages/app-types/index.d.ts","/tmp/firebase-TMP/firebase-js-sdk/packages/installations/src/api/delete-installation.ts","/tmp/firebase-TMP/firebase-js-sdk/packages/installations/src/helpers/extract-app-config.ts","/tmp/firebase-TMP/firebase-js-sdk/packages/installations/src/helpers/idb-manager.ts","/tmp/firebase-TMP/firebase-js-sdk/packages/installations/src/interfaces/installation-entry.ts","/tmp/firebase-TMP/firebase-js-sdk/packages/installations/src/util/errors.ts"],"map":"{\"version\":3,\"file\":\"delete-installation.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../src/functions/delete-installation.ts\"],\"names\":[],\"mappings\":\"AAAA;;;;;;;;;;;;;;;GAeG;;AAGH,OAAO,EAAE,kBAAkB,IAAI,yBAAyB,EAAE,MAAM,4BAA4B,CAAC;AAC7F,OAAO,EAAE,gBAAgB,EAAE,MAAM,+BAA+B,CAAC;AACjE,OAAO,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM,wBAAwB,CAAC;AAOxD,OAAO,EAAE,aAAa,EAAa,MAAM,gBAAgB,CAAC;AAE1D,MAAM,UAAgB,kBAAkB,CAAC,GAAgB;;;;;;oBACjD,SAAS,GAAG,gBAAgB,CAAC,GAAG,CAAC,CAAC;oBAE1B,qBAAM,MAAM,CACxB,SAAS,EACT,UACE,QAA4B;4BAK5B,IACE,QAAQ;gCACR,QAAQ,CAAC,kBAAkB,wBAA8B,EACzD;gCACA,8EAA8E;gCAC9E,OAAO,SAAS,CAAC;6BAClB;4BACD,OAAO,QAAQ,CAAC;wBAClB,CAAC,CACF,EAAA;;oBAjBK,KAAK,GAAG,SAiBb;yBAEG,KAAK,EAAL,wBAAK;yBACH,CAAA,KAAK,CAAC,kBAAkB,wBAA8B,CAAA,EAAtD,wBAAsD;oBACxD,yCAAyC;oBACzC,MAAM,aAAa,CAAC,MAAM,iEAAuC,CAAC;;yBACzD,CAAA,KAAK,CAAC,kBAAkB,sBAA4B,CAAA,EAApD,wBAAoD;yBACzD,CAAC,SAAS,CAAC,MAAM,EAAjB,wBAAiB;oBACnB,MAAM,aAAa,CAAC,MAAM,iCAAuB,CAAC;wBAElD,qBAAM,yBAAyB,CAAC,SAAS,EAAE,KAAK,CAAC,EAAA;;oBAAjD,SAAiD,CAAC;oBAClD,qBAAM,MAAM,CAAC,SAAS,CAAC,EAAA;;oBAAvB,SAAuB,CAAC;;;;;;CAI/B\"}","dts":{"name":"/tmp/firebase-TMP/firebase-js-sdk/packages/installations/src/functions/delete-installation.d.ts","writeByteOrderMark":false,"text":"/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nimport { FirebaseApp } from '@firebase/app-types';\r\nexport declare function deleteInstallation(app: FirebaseApp): Promise<void>;\r\n"}}
