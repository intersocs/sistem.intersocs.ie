{"code":"/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nimport * as tslib_1 from \"tslib\";\r\nimport { INTERNAL_AUTH_VERSION, PACKAGE_VERSION } from '../util/constants';\r\nimport { extractAuthTokenInfoFromResponse, getErrorFromResponse, getHeaders, getInstallationsEndpoint, retryIfServerError } from './common';\r\nexport function createInstallation(appConfig, _a) {\r\n    var fid = _a.fid;\r\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\r\n        var endpoint, headers, body, request, response, responseValue, registeredInstallationEntry;\r\n        return tslib_1.__generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0:\r\n                    endpoint = getInstallationsEndpoint(appConfig);\r\n                    headers = getHeaders(appConfig);\r\n                    body = {\r\n                        fid: fid,\r\n                        authVersion: INTERNAL_AUTH_VERSION,\r\n                        appId: appConfig.appId,\r\n                        sdkVersion: PACKAGE_VERSION\r\n                    };\r\n                    request = {\r\n                        method: 'POST',\r\n                        headers: headers,\r\n                        body: JSON.stringify(body)\r\n                    };\r\n                    return [4 /*yield*/, retryIfServerError(function () { return fetch(endpoint, request); })];\r\n                case 1:\r\n                    response = _b.sent();\r\n                    if (!response.ok) return [3 /*break*/, 3];\r\n                    return [4 /*yield*/, response.json()];\r\n                case 2:\r\n                    responseValue = _b.sent();\r\n                    registeredInstallationEntry = {\r\n                        fid: responseValue.fid || fid,\r\n                        registrationStatus: 2 /* COMPLETED */,\r\n                        refreshToken: responseValue.refreshToken,\r\n                        authToken: extractAuthTokenInfoFromResponse(responseValue.authToken)\r\n                    };\r\n                    return [2 /*return*/, registeredInstallationEntry];\r\n                case 3: return [4 /*yield*/, getErrorFromResponse('Create Installation', response)];\r\n                case 4: throw _b.sent();\r\n            }\r\n        });\r\n    });\r\n}\r\n//# sourceMappingURL=create-installation.js.map","references":["/tmp/firebase-TMP/firebase-js-sdk/packages/installations/src/interfaces/api-response.ts","/tmp/firebase-TMP/firebase-js-sdk/packages/installations/src/interfaces/app-config.ts","/tmp/firebase-TMP/firebase-js-sdk/packages/installations/src/interfaces/installation-entry.ts","/tmp/firebase-TMP/firebase-js-sdk/packages/installations/src/util/constants.ts","/tmp/firebase-TMP/firebase-js-sdk/packages/installations/src/api/common.ts"],"map":"{\"version\":3,\"file\":\"create-installation.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../src/api/create-installation.ts\"],\"names\":[],\"mappings\":\"AAAA;;;;;;;;;;;;;;;GAeG;;AASH,OAAO,EAAE,qBAAqB,EAAE,eAAe,EAAE,MAAM,mBAAmB,CAAC;AAC3E,OAAO,EACL,gCAAgC,EAChC,oBAAoB,EACpB,UAAU,EACV,wBAAwB,EACxB,kBAAkB,EACnB,MAAM,UAAU,CAAC;AAElB,MAAM,UAAgB,kBAAkB,CACtC,SAAoB,EACpB,EAAoC;QAAlC,YAAG;;;;;;oBAEC,QAAQ,GAAG,wBAAwB,CAAC,SAAS,CAAC,CAAC;oBAE/C,OAAO,GAAG,UAAU,CAAC,SAAS,CAAC,CAAC;oBAChC,IAAI,GAAG;wBACX,GAAG,KAAA;wBACH,WAAW,EAAE,qBAAqB;wBAClC,KAAK,EAAE,SAAS,CAAC,KAAK;wBACtB,UAAU,EAAE,eAAe;qBAC5B,CAAC;oBAEI,OAAO,GAAgB;wBAC3B,MAAM,EAAE,MAAM;wBACd,OAAO,SAAA;wBACP,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC;qBAC3B,CAAC;oBAEe,qBAAM,kBAAkB,CAAC,cAAM,OAAA,KAAK,CAAC,QAAQ,EAAE,OAAO,CAAC,EAAxB,CAAwB,CAAC,EAAA;;oBAAnE,QAAQ,GAAG,SAAwD;yBACrE,QAAQ,CAAC,EAAE,EAAX,wBAAW;oBACqC,qBAAM,QAAQ,CAAC,IAAI,EAAE,EAAA;;oBAAjE,aAAa,GAA+B,SAAqB;oBACjE,2BAA2B,GAAgC;wBAC/D,GAAG,EAAE,aAAa,CAAC,GAAG,IAAI,GAAG;wBAC7B,kBAAkB,mBAAyB;wBAC3C,YAAY,EAAE,aAAa,CAAC,YAAY;wBACxC,SAAS,EAAE,gCAAgC,CAAC,aAAa,CAAC,SAAS,CAAC;qBACrE,CAAC;oBACF,sBAAO,2BAA2B,EAAC;wBAE7B,qBAAM,oBAAoB,CAAC,qBAAqB,EAAE,QAAQ,CAAC,EAAA;wBAAjE,MAAM,SAA2D,CAAC;;;;CAErE\"}","dts":{"name":"/tmp/firebase-TMP/firebase-js-sdk/packages/installations/src/api/create-installation.d.ts","writeByteOrderMark":false,"text":"/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nimport { AppConfig } from '../interfaces/app-config';\r\nimport { InProgressInstallationEntry, RegisteredInstallationEntry } from '../interfaces/installation-entry';\r\nexport declare function createInstallation(appConfig: AppConfig, { fid }: InProgressInstallationEntry): Promise<RegisteredInstallationEntry>;\r\n"}}
